#
# @TEST-EXEC:  hilti-build -d %INPUT ${PAC_DRIVER} -o a.out
# @TEST-EXEC:  printf '\x03abc\x04efgh\x00\x03123\xffgihjk' | HILTI_DEBUG=$HILTI_DEBUG:binpac ./a.out >output
# @TEST-EXEC:  btest-diff output
#
# DNS-like madness.

module Test;

export type Packet = unit() {
    data: bytes &length=10;
    name: Name(self);
    data2: bytes &length=5;
};

type Name = unit(p: Packet) {
    labels: list<Label(p)> &until($$.len == 0 || $$.len == 255);
};

type Label = unit(p: Packet) {
    len: uint8;

    switch ( self.len ) {
        255 -> n2: Name(p) &parse(p.input());
        *   -> l: bytes &length=self.len;
    };
};
